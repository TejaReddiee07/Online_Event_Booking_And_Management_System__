{% extends "layout_admin.html" %}
{% block title %}Manage Halls - Admin{% endblock %}

{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h3 class="mb-0">Manage Event Halls</h3>
  <button class="btn btn-success" onclick="toggleAddForm()">
    <span id="addBtnText">+ Add New Hall</span>
  </button>
</div>

<!-- Add Hall Form (Hidden by default) -->
<div class="card mb-4" id="addHallForm" style="display: none;">
  <div class="card-body">
    <h5 class="card-title mb-3">Add New Hall</h5>
    <form method="post" enctype="multipart/form-data">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Hall Name</label>
          <input type="text" name="title" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Capacity</label>
          <input type="number" name="capacity" class="form-control" required>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Price per Hour (‚Çπ)</label>
          <input type="number" name="price" class="form-control" step="0.01" required>
        </div>
<div class="col-md-6 mb-3">
  <label class="form-label">Location / City</label>
  <select name="location" class="form-control" required>
    <option value="">Select Location</option>
    <option value="Bengaluru">Bengaluru</option>
    <option value="Hyderabad">Hyderabad</option>
    <option value="Mumbai">Mumbai</option>
    <option value="Delhi">Delhi</option>
    <option value="Chennai">Chennai</option>
    <option value="Pune">Pune</option>
    <option value="Kolkata">Kolkata</option>
    <option value="Warangal">Warangal</option>
  </select>
</div>

      </div>

      <div class="mb-3">
        <label class="form-label">Address</label>
        <textarea name="address" class="form-control" rows="2" required></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea name="description" class="form-control" rows="3" required></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Picture</label>
        <input type="file" name="picture" class="form-control" accept="image/*">
      </div>

      <button type="submit" class="btn btn-primary">Add Hall</button>
      <button type="button" class="btn btn-secondary" onclick="toggleAddForm()">Cancel</button>
    </form>
  </div>
</div>

<!-- Location Filter -->
<div class="mb-4">
  <h6 class="mb-3">Filter by Location:</h6>
  <div class="btn-group" role="group">
    <a href="{{ url_for('admin.halls', location='all') }}"
       class="btn btn-sm {{ 'btn-primary' if request.args.get('location', 'all') == 'all' else 'btn-outline-primary' }}">
      All Cities
    </a>
    {% for loc in all_locations %}
    <a href="{{ url_for('admin.halls', location=loc) }}"
       class="btn btn-sm {{ 'btn-primary' if request.args.get('location') == loc else 'btn-outline-primary' }}">
      {{ loc }}
    </a>
    {% endfor %}
  </div>
</div>

<!-- Display Halls -->
<h5 class="mb-3">
  {% if request.args.get('location') and request.args.get('location') != 'all' %}
    Halls in {{ request.args.get('location') }}
  {% else %}
    All Halls
  {% endif %}
</h5>

<div class="row">
  {% for hall in halls %}
  <div class="col-md-4 mb-4">
    <div class="card hall-card h-100">
      {% if hall.picture %}
      <img src="{{ hall.picture }}" class="card-img-top" alt="{{ hall.title }}">
      {% endif %}
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ hall.title }}</h5>
        <p class="card-text mb-1">
          <strong>üìç {{ hall.location }}</strong>
        </p>
        <p class="card-text mb-1">
          <strong>Capacity:</strong> {{ hall.capacity }}
        </p>
        <p class="card-text mb-3">
          <strong>Price:</strong> ‚Çπ{{ hall.price }}/hour
        </p>
        <p class="card-text text-muted small">
          {{ hall.address }}
        </p>
      </div>
    </div>
  </div>
  {% else %}
  <div class="col-12">
    <div class="alert alert-info text-center">
      No halls found
      {% if request.args.get('location') and request.args.get('location') != 'all' %}
        in {{ request.args.get('location') }}
      {% endif %}.
    </div>
  </div>
  {% endfor %}
</div>

<script>
  function toggleAddForm() {
    const form = document.getElementById('addHallForm');
    const btnText = document.getElementById('addBtnText');
    
    if (form.style.display === 'none') {
      form.style.display = 'block';
      btnText.textContent = '‚úï Cancel';
      form.scrollIntoView({ behavior: 'smooth' });
    } else {
      form.style.display = 'none';
      btnText.textContent = '+ Add New Hall';
    }
  }
</script>
{% endblock %}
